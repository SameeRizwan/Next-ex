{"ast":null,"code":"import connectDb from \"../../utils/connectDb\";\nimport Userauth from \"../../models/Userauth\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport Login from \"../login\";\nconnectDb();\nexport default (async (req, res) => {\n  const {\n    email,\n    password\n  } = req.body;\n  console.log(email);\n  console.log(password);\n\n  try {\n    // 1) check to see if a user exists with the provided email\n    const user = await Userauth.findOne({\n      email\n    }).select(\"+password\"); // 2) --if not, return error\n\n    if (!user) {\n      return res.status(404).send(\"No user exists with that email\");\n    } // 3) check to see if users' password matches the one in db\n\n\n    const passwordsMatch = await bcrypt.compare(password, user.password); // 4) --if so, generate a token\n\n    if (passwordsMatch) {\n      const token = jwt.sign({\n        userId: user._id,\n        username: user.username\n      }, process.env.JWT_SECRET, {\n        expiresIn: \"1d\"\n      }); // 5) send that token to the client\n\n      res.status(200).json(token);\n    } else {\n      res.status(401).send(\"Passwords do not match\");\n    }\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Error logging in user\");\n  }\n});","map":{"version":3,"sources":["D:/FYP/pages/api/login.js"],"names":["connectDb","Userauth","bcrypt","jwt","Login","req","res","email","password","body","console","log","user","findOne","select","status","send","passwordsMatch","compare","token","sign","userId","_id","username","process","env","JWT_SECRET","expiresIn","json","error"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,uBAAtB;AACA,OAAOC,QAAP,MAAqB,uBAArB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AAEAJ,SAAS;AAET,gBAAe,OAAOK,GAAP,EAAYC,GAAZ,KAAoB;AAEjC,QAAM;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAsBH,GAAG,CAACI,IAAhC;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYJ,KAAZ;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAYH,QAAZ;;AAEA,MAAI;AACF;AACA,UAAMI,IAAI,GAAG,MAAMX,QAAQ,CAACY,OAAT,CAAiB;AAAEN,MAAAA;AAAF,KAAjB,EAA4BO,MAA5B,CAAmC,WAAnC,CAAnB,CAFE,CAIF;;AACA,QAAI,CAACF,IAAL,EAAW;AACT,aAAON,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,gCAArB,CAAP;AAED,KARC,CASF;;;AACA,UAAMC,cAAc,GAAG,MAAMf,MAAM,CAACgB,OAAP,CAAeV,QAAf,EAAyBI,IAAI,CAACJ,QAA9B,CAA7B,CAVE,CAWF;;AACA,QAAIS,cAAJ,EAAoB;AAClB,YAAME,KAAK,GAAGhB,GAAG,CAACiB,IAAJ,CAAS;AAAEC,QAAAA,MAAM,EAAET,IAAI,CAACU,GAAf;AAAoBC,QAAAA,QAAQ,EAAEX,IAAI,CAACW;AAAnC,OAAT,EAAwDC,OAAO,CAACC,GAAR,CAAYC,UAApE,EAAgF;AAC5FC,QAAAA,SAAS,EAAE;AADiF,OAAhF,CAAd,CADkB,CAIlB;;AACArB,MAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBa,IAAhB,CAAqBT,KAArB;AACD,KAND,MAMO;AACLb,MAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,wBAArB;AACD;AACF,GArBD,CAqBE,OAAOa,KAAP,EAAc;AACdnB,IAAAA,OAAO,CAACmB,KAAR,CAAcA,KAAd;AACAvB,IAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uBAArB;AACD;AACF,CA/BD","sourcesContent":["import connectDb from \"../../utils/connectDb\";\r\nimport Userauth from \"../../models/Userauth\";\r\nimport bcrypt from \"bcrypt\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport Login from \"../login\";\r\n\r\nconnectDb();\r\n\r\nexport default async (req, res) => {\r\n\r\n  const { email, password } = req.body;\r\n  console.log(email);\r\n  console.log(password);\r\n \r\n  try {\r\n    // 1) check to see if a user exists with the provided email\r\n    const user = await Userauth.findOne({ email }).select(\"+password\");\r\n    \r\n    // 2) --if not, return error\r\n    if (!user) {\r\n      return res.status(404).send(\"No user exists with that email\");\r\n    \r\n    }\r\n    // 3) check to see if users' password matches the one in db\r\n    const passwordsMatch = await bcrypt.compare(password, user.password);\r\n    // 4) --if so, generate a token\r\n    if (passwordsMatch) {\r\n      const token = jwt.sign({ userId: user._id, username: user.username }, process.env.JWT_SECRET, {\r\n        expiresIn: \"1d\"\r\n      });\r\n      // 5) send that token to the client\r\n      res.status(200).json(token);\r\n    } else {\r\n      res.status(401).send(\"Passwords do not match\");\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).send(\"Error logging in user\");\r\n  }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}